{% extends 'base.html' %}

{% block title %}Add Question - Django Lab{% endblock %}

{% block content %}
<div class="add-question">
    <h1>Add Question to: {{ test.title }}</h1>
    
    <form method="post">
        {% csrf_token %}
        <div class="form-group">
            <label for="question_text">Question Text</label>
            <textarea id="question_text" name="question_text" rows="3" required></textarea>
        </div>
        <div class="form-group">
            <label for="question_type">Question Type</label>
            <select id="question_type" name="question_type" onchange="toggleOptions()">
                <option value="multiple_choice">Multiple Choice</option>
                <option value="true_false">True/False</option>
                <option value="short_answer">Short Answer</option>
            </select>
        </div>
        
        <!-- Multiple Choice Options -->
        <div id="multiple_choice_options" class="options-section">
            <h3>Multiple Choice Options</h3>
            <p class="help-text">Enter the options and mark the correct answer.</p>
            
            <div class="option-row">
                <input type="text" name="option_a" placeholder="Option A" class="option-input">
                <label class="correct-answer">
                    <input type="radio" name="correct_option" value="a"> Correct Answer
                </label>
            </div>
            <div class="option-row">
                <input type="text" name="option_b" placeholder="Option B" class="option-input">
                <label class="correct-answer">
                    <input type="radio" name="correct_option" value="b"> Correct Answer
                </label>
            </div>
            <div class="option-row">
                <input type="text" name="option_c" placeholder="Option C" class="option-input">
                <label class="correct-answer">
                    <input type="radio" name="correct_option" value="c"> Correct Answer
                </label>
            </div>
            <div class="option-row">
                <input type="text" name="option_d" placeholder="Option D" class="option-input">
                <label class="correct-answer">
                    <input type="radio" name="correct_option" value="d"> Correct Answer
                </label>
            </div>
        </div>
        
        <!-- True/False Options -->
        <div id="true_false_options" class="options-section" style="display: none;">
            <h3>True/False Options</h3>
            <p class="help-text">Mark the correct answer.</p>
            
            <div class="option-row">
                <span class="option-text">True</span>
                <label class="correct-answer">
                    <input type="checkbox" name="correct_true"> Correct Answer
                </label>
            </div>
            <div class="option-row">
                <span class="option-text">False</span>
                <label class="correct-answer">
                    <input type="checkbox" name="correct_false"> Correct Answer
                </label>
            </div>
        </div>
        
        <!-- Short Answer (no options needed) -->
        <div id="short_answer_info" class="options-section" style="display: none;">
            <p class="help-text">For short answer questions, students will type their answer. You'll need to grade these manually.</p>
        </div>
        
        <div class="form-group">
            <label for="points">Points</label>
            <input type="number" id="points" name="points" value="1" min="1">
        </div>
        <button type="submit" class="btn btn-primary">Add Question</button>
    </form>
    
    <div class="existing-questions">
        <h3>Questions in this Test</h3>
        {% for question in test.questions.all %}
        <div class="question-item">
            <p><strong>{{ forloop.counter }}.</strong> {{ question.text }}</p>
            <small>
                Type: {{ question.get_question_type_display }} | 
                Points: {{ question.points }}
            </small>
            <div class="question-actions">
                <a href="{% url 'edit_question' test.id question.id %}" class="btn btn-sm btn-secondary">Edit</a>
            </div>
            {% if question.options.exists %}
            <div class="question-options">
                <small>Options:</small>
                {% for option in question.options.all %}
                <span class="option-badge {% if option.is_correct %}correct{% endif %}">
                    {{ option.option_text }}{% if option.is_correct %} âœ“{% endif %}
                </span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        {% empty %}
        <p>No questions added yet.</p>
        {% endfor %}
    </div>
</div>

<script>
function toggleOptions() {
    var questionType = document.getElementById('question_type').value;
    
    document.getElementById('multiple_choice_options').style.display = 
        questionType === 'multiple_choice' ? 'block' : 'none';
    document.getElementById('true_false_options').style.display = 
        questionType === 'true_false' ? 'block' : 'none';
    document.getElementById('short_answer_info').style.display = 
        questionType === 'short_answer' ? 'block' : 'none';
}
</script>

<style>
.options-section {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin: 15px 0;
    border: 1px solid #dee2e6;
}
.option-row {
    display: flex;
    align-items: center;
    gap: 15px;
    margin: 10px 0;
}
.option-input {
    flex: 1;
    padding: 8px;
    border: 1px solid #ced4da;
    border-radius: 4px;
}
.option-text {
    font-weight: bold;
    min-width: 100px;
}
.correct-answer {
    display: flex;
    align-items: center;
    gap: 5px;
    cursor: pointer;
}
.question-item {
    background: #fff;
    border: 1px solid #dee2e6;
    padding: 15px;
    margin: 10px 0;
    border-radius: 5px;
}
.question-options {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #dee2e6;
}
.question-actions {
    margin-top: 8px;
}
.option-badge {
    display: inline-block;
    background: #e9ecef;
    padding: 3px 8px;
    margin: 2px;
    border-radius: 3px;
    font-size: 0.85em;
}
.option-badge.correct {
    background: #d4edda;
    color: #155724;
}
.help-text {
    color: #6c757d;
    font-size: 0.9em;
    margin: 5px 0;
}
</style>
{% endblock %}
